<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HEAT Companion â€” Pedal to the Metal</title>
  <meta name="description" content="Companion app para gestionar campeonatos del juego de mesa Heat: Pedal to the Metal." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="app">

  <!-- ========== SIDEBAR ========== -->
  <div id="sidebar-backdrop" class="sidebar-backdrop"></div>
  <nav id="sidebar">
    <button id="btn-close-sidebar" class="sidebar-close">âœ•</button>
    <div class="sidebar-logo">
      <div class="logo-icon">ğŸ</div>
      <div class="logo-text">
        <span class="logo-title">HEAT</span>
        <span class="logo-sub">Companion</span>
      </div>
    </div>

    <ul class="nav-links">
      <li><a href="#" class="nav-link active" data-view="dashboard" id="nav-dashboard">
        <span class="nav-icon">ğŸ</span><span>Dashboard</span>
      </a></li>
      <li><a href="#" class="nav-link" data-view="championship" id="nav-championship">
        <span class="nav-icon">ğŸ†</span><span>Campeonato</span>
      </a></li>
      <li><a href="#" class="nav-link" data-view="players" id="nav-players">
        <span class="nav-icon">ğŸ‘¤</span><span>Pilotos</span>
      </a></li>
      <li><a href="#" class="nav-link" data-view="standings" id="nav-standings">
        <span class="nav-icon">ğŸ“Š</span><span>ClasificaciÃ³n</span>
      </a></li>
      <li><a href="#" class="nav-link" data-view="manual" id="nav-manual">
        <span class="nav-icon">ğŸ“–</span><span>Referencia</span>
      </a></li>
    </ul>

    <div class="sidebar-championship">
      <div class="championship-label">Campeonato</div>
      <div class="championship-name" id="sidebar-champ-name">Sin nombre</div>
      <button class="btn-edit-champ" id="btn-edit-champ">âœ Configurar</button>
    </div>

    <div class="sidebar-data-actions">
      <button class="btn-data-action" id="btn-theme-toggle" title="Cambiar tema">ğŸŒ™ Modo</button>
      <button class="btn-data-action" id="btn-export" title="Exportar">â¬‡ Exportar</button>
      <button class="btn-data-action btn-data-import" id="btn-import" title="Importar">â¬† Importar</button>
    </div>
    <div class="sidebar-data-actions" style="padding-top:0">
      <button class="btn-data-action btn-data-reset" id="btn-open-reset">âš  Resetear...</button>
    </div>
  </nav>

  <!-- ========== MAIN CONTENT ========== -->
  <main id="main-content">

    <!-- DASHBOARD -->
    <div id="view-dashboard" class="view active">
      <div class="view-header">
        <div>
          <h1 id="dash-title">Bienvenido a HEAT Companion</h1>
          <p id="dash-subtitle">Gestiona tu campeonato de Heat: Pedal to the Metal</p>
        </div>
      </div>
      <div class="dashboard-grid">
        <div class="stat-card"><div class="stat-icon">ğŸ</div><div class="stat-value" id="stat-races-val">0</div><div class="stat-label">Carreras disputadas</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ“…</div><div class="stat-value" id="stat-pending-val">0</div><div class="stat-label">Carreras pendientes</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ‘¤</div><div class="stat-value" id="stat-players-val">0</div><div class="stat-label">Pilotos inscritos</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ¥‡</div><div class="stat-value" id="stat-leader-val">â€”</div><div class="stat-label">LÃ­der del campeonato</div></div>
      </div>
      <div class="section-card">
        <div class="section-header">
          <h2>ClasificaciÃ³n actual</h2>
          <a href="#" class="link-view-all" data-view="standings">Ver completa â†’</a>
        </div>
        <div id="dash-standings-list" class="mini-standings"></div>
      </div>
      <div class="section-card">
        <div class="section-header">
          <h2>PrÃ³ximas / Ãšltimas carreras</h2>
          <a href="#" class="link-view-all" data-view="championship">Ver calendario â†’</a>
        </div>
        <div id="dash-recent-races" class="recent-races-list"></div>
      </div>
    </div>

    <!-- CHAMPIONSHIP -->
    <div id="view-championship" class="view">
      <div class="view-header">
        <div>
          <h1 id="champ-view-name">Campeonato</h1>
          <p id="champ-view-sub">Gestiona el calendario, los pilotos y los resultados</p>
        </div>
        <button class="btn-secondary" id="btn-champ-settings-inline">âœ Configurar</button>
      </div>

      <!-- Enrolled players -->
      <div class="section-card">
        <div class="section-header">
          <h2>ğŸ‘¤ Pilotos inscritos</h2>
        </div>
        <p class="form-hint" style="margin-bottom:14px">Activa los pilotos que participan en este campeonato.</p>
        <div id="champ-enrolled-players" class="enrolled-players-list"></div>
        <div id="champ-no-players" style="display:none;color:var(--text-dim);font-size:13px;padding:10px 0">
          No hay pilotos creados todavÃ­a. Ve a la secciÃ³n "Pilotos" para aÃ±adirlos.
        </div>
      </div>

      <!-- Race calendar -->
      <div class="section-card">
        <div class="section-header">
          <h2>ğŸ—“ Calendario de carreras</h2>
          <div class="header-actions">
            <button class="btn-text-icon" id="btn-show-champ-templates">ğŸ“œ HistÃ³ricos</button>
            <button class="btn-text-icon" id="btn-reset-championship">ğŸ”„ Reiniciar</button>
            <button class="btn-primary" id="btn-add-cal-race">+ AÃ±adir carrera</button>
          </div>
        </div>
        <div id="calendar-list" class="calendar-list"></div>
        <div id="calendar-empty" class="empty-state" style="display:none">
          <div class="empty-icon">ğŸ“…</div>
          <p>El calendario estÃ¡ vacÃ­o. Â¡AÃ±ade la primera carrera!</p>
        </div>
      </div>
    </div>

    <!-- PLAYERS -->
    <div id="view-players" class="view">
      <div class="view-header">
        <div>
          <h1>Pilotos</h1>
          <p>Gestiona los pilotos y sus cartas de mejora</p>
        </div>
        <button class="btn-primary" id="btn-add-player">+ AÃ±adir piloto</button>
      </div>
      <div id="players-grid" class="players-grid"></div>
      <div id="players-empty" class="empty-state" style="display:none">
        <div class="empty-icon">ğŸ‘¤</div>
        <p>No hay pilotos aÃºn. Â¡AÃ±ade el primero!</p>
      </div>
    </div>

    <!-- STANDINGS -->
    <div id="view-standings" class="view">
      <div class="view-header">
        <div>
          <h1>ClasificaciÃ³n del Campeonato</h1>
          <p id="standings-champ-name">â€”</p>
        </div>
      </div>
      <div id="standings-table-wrap" class="standings-wrap"></div>
      <div id="standings-empty" class="empty-state" style="display:none">
        <div class="empty-icon">ğŸ“Š</div>
        <p>AÃ±ade pilotos al campeonato y disputa carreras para ver la clasificaciÃ³n</p>
      </div>
    </div>

    <!-- MANUAL / REFERENCE -->
    <div id="view-manual" class="view">
      <div class="view-header">
        <div>
          <h1>Manual de Referencia</h1>
          <p>Consulta las reglas rÃ¡pidas de Clima, Motor Forzado y EstrÃ©s</p>
        </div>
      </div>

      <div class="manual-grid">
        <div class="section-card">
          <h2>ğŸ”¥ MecÃ¡nicas BÃ¡sicas</h2>
          <div id="manual-basics-list" class="manual-list"></div>
        </div>
        <div class="section-card">
          <h2>ğŸŒ¤ï¸ Efectos de Clima</h2>
          <div id="manual-weather-list" class="manual-list"></div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- Hidden file input -->
<input type="file" id="import-file-input" accept=".json,application/json" style="display:none" />

<!-- ========== MODALS ========== -->

<!-- Championship config -->
<div id="modal-champ" class="modal-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h2>Configurar Campeonato</h2>
      <button class="modal-close" data-modal="modal-champ">âœ•</button>
    </div>
    <div class="modal-body">
      <label class="form-label">Nombre del campeonato</label>
      <input class="form-input" id="champ-name-input" type="text" placeholder="Ej: Gran Premio Anual 2025" maxlength="60" />
      <label class="form-label">Sistema de puntos</label>
      <select class="form-select" id="champ-points-select">
        <option value="f1">F1 moderno (25-18-15-12-10-8-6-4-2-1)</option>
        <option value="f1old">F1 clÃ¡sico (10-6-4-3-2-1)</option>
        <option value="simple">Simple (6-5-4-3-2-1)</option>
        <option value="podium">Solo podio (3-2-1)</option>
        <option value="custom">Personalizado</option>
      </select>
      <input class="form-input" id="champ-points-custom" type="text"
        placeholder="Ej: 25,18,15,12,10,8,6,4,2,1 (separados por comas)"
        style="display:none; margin-top:8px" />
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-champ">Cancelar</button>
      <button class="btn-primary" id="btn-save-champ">Guardar</button>
    </div>
  </div>
</div>

<!-- Add / Edit Player â€” includes upgrades -->
<div id="modal-player" class="modal-overlay" style="display:none">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h2 id="modal-player-title">AÃ±adir piloto</h2>
      <button class="modal-close" data-modal="modal-player">âœ•</button>
    </div>
    <div class="modal-body">
      <!-- Basic info -->
      <label class="form-label">Nombre del piloto</label>
      <input class="form-input" id="player-name-input" type="text" placeholder="Ej: Carlos Sainz" maxlength="30" />
      <div style="margin: 4px 0 16px">
        <label class="checkbox-label"><input type="checkbox" id="player-is-legend" /> Piloto Leyenda (Bot)</label>
      </div>

      <label class="form-label">Color del coche</label>
      <div class="color-picker" id="player-color-picker">
        <div class="color-option selected" data-color="#e63b2e" style="background:#e63b2e" title="Rojo"></div>
        <div class="color-option" data-color="#f97316" style="background:#f97316" title="Naranja"></div>
        <div class="color-option" data-color="#eab308" style="background:#eab308" title="Amarillo"></div>
        <div class="color-option" data-color="#22c55e" style="background:#22c55e" title="Verde"></div>
        <div class="color-option" data-color="#3b82f6" style="background:#3b82f6" title="Azul"></div>
        <div class="color-option" data-color="#a855f7" style="background:#a855f7" title="Morado"></div>
        <div class="color-option" data-color="#000000" style="background:#000000" title="Negro"></div>
        <div class="color-option" data-color="#94a3b8" style="background:#94a3b8" title="Gris"></div>
      </div>

      <label class="form-label">Icono / NÃºmero</label>
      <input class="form-input" id="player-icon-input" type="text" placeholder="Ej: 1, 77, â­" maxlength="3" />

      <!-- Upgrades -->
      <div class="modal-section-divider">
        <span class="modal-section-label"></span>
      </div>
      <p class="form-hint">Gestiona las mejoras tÃ©cnicas y los patrocinios permanentes del piloto.</p>
      <div id="player-upgrades-container"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-player">Cancelar</button>
      <button class="btn-primary" id="btn-save-player">Guardar</button>
    </div>
  </div>
</div>

<!-- Add race to calendar -->
<div id="modal-add-race" class="modal-overlay" style="display:none">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h2 id="modal-add-race-title">AÃ±adir carrera al calendario</h2>
      <button class="modal-close" data-modal="modal-add-race">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-section">
        <h3 class="form-section-title">1. Circuito</h3>
        <div class="circuits-grid" id="add-race-circuits-grid"></div>
      </div>

      <div class="form-section">
        <h3 class="form-section-title">2. Opciones</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">MÃ³dulos activos</label>
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="add-race-mod-weather" /> ğŸŒ§ Clima</label>
              <label class="checkbox-label"><input type="checkbox" id="add-race-mod-sponsors" /> ğŸ’° Patrocinadores</label>
              <label class="checkbox-label"><input type="checkbox" id="add-race-mod-press" /> ğŸ“· Prensa</label>
            </div>
          </div>
        </div>
        <p class="form-hint">Las nuevas carreras se aÃ±adirÃ¡n al final del calendario.</p>

        <div id="add-race-weather-section" style="display:none; margin-top:16px; padding-top:16px; border-top:1px dashed var(--border)">
          <label class="form-label">Selecciona el clima</label>
          <div class="weather-selector-grid" id="add-race-weather-grid"></div>
        </div>

        <div id="add-race-sponsors-section" style="display:none; margin-top:16px; padding-top:16px; border-top:1px dashed var(--border)">
          <label class="form-label">Cartas de patrocinio al inicio</label>
          <div class="number-selector-grid" id="add-race-sponsors-grid">
            <div class="number-chip" data-val="0">0</div>
            <div class="number-chip selected" data-val="1">1</div>
            <div class="number-chip" data-val="2">2</div>
            <div class="number-chip" data-val="3">3</div>
          </div>
        </div>

        <div id="add-race-press-section" style="display:none; margin-top:16px; padding-top:16px; border-top:1px dashed var(--border)">
          <label class="form-label">UbicaciÃ³n de CÃ¡maras de Prensa</label>
          <input class="form-input" id="add-race-press-input" type="text" placeholder="Ej: Curva A, Curvas B y D..." />
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-add-race">Cancelar</button>
      <button class="btn-primary" id="btn-save-cal-race">AÃ±adir al calendario</button>
    </div>
  </div>
</div>

<!-- Enter race results -->
<div id="modal-results" class="modal-overlay" style="display:none">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h2 id="modal-results-title">Registrar resultado</h2>
      <button class="modal-close" data-modal="modal-results">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="form-hint" style="margin-bottom:18px">
        Ordena los pilotos segÃºn la posiciÃ³n final. Usa los botones â–²â–¼ o arrastra.
      </p>
      <div id="results-sortable-list" class="results-sortable"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-results">Cancelar</button>
      <button class="btn-primary" id="btn-save-results">Guardar resultado</button>
    </div>
  </div>
</div>

<!-- Race detail (view only) -->
<div id="modal-race-detail" class="modal-overlay" style="display:none">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h2 id="detail-race-title">Detalle de carrera</h2>
      <button class="modal-close" data-modal="modal-race-detail">âœ•</button>
    </div>
    <div class="modal-body" id="detail-race-body"></div>
    <div class="modal-footer">
      <button class="btn-danger" id="btn-delete-race">ğŸ—‘ Eliminar</button>
      <button class="btn-secondary" id="btn-edit-result">âœ Editar resultado</button>
      <button class="btn-secondary" data-modal="modal-race-detail">Cerrar</button>
    </div>
  </div>
</div>

<!-- Reset modal -->
<div id="modal-reset" class="modal-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h2>âš  Resetear datos</h2>
      <button class="modal-close" data-modal="modal-reset">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="reset-intro">Selecciona quÃ© secciÃ³n quieres borrar. Esta acciÃ³n <strong>no se puede deshacer</strong>.</p>
      <div class="reset-cards">
        <div class="reset-card">
          <div class="reset-card-icon">âš™ï¸</div>
          <div class="reset-card-info">
            <div class="reset-card-title">ConfiguraciÃ³n del campeonato</div>
            <div class="reset-card-desc">Borra nombre y puntos. Mantiene pilotos y calendario.</div>
          </div>
          <button class="btn-reset-section" data-section="championship">Resetear</button>
        </div>
        <div class="reset-card">
          <div class="reset-card-icon">ğŸ</div>
          <div class="reset-card-info">
            <div class="reset-card-title">Calendario de carreras</div>
            <div class="reset-card-desc">Elimina todas las carreras y resultados. Mantiene los pilotos.</div>
          </div>
          <button class="btn-reset-section" data-section="calendar">Resetear</button>
        </div>
        <div class="reset-card">
          <div class="reset-card-icon">ğŸ‘¤</div>
          <div class="reset-card-info">
            <div class="reset-card-title">Pilotos</div>
            <div class="reset-card-desc">Elimina todos los pilotos y tambiÃ©n el calendario.</div>
          </div>
          <button class="btn-reset-section" data-section="players">Resetear</button>
        </div>
        <div class="reset-card reset-card-danger">
          <div class="reset-card-icon">ğŸ’¥</div>
          <div class="reset-card-info">
            <div class="reset-card-title">Reset global</div>
            <div class="reset-card-desc">Borra absolutamente todo y vuelve al estado inicial.</div>
          </div>
          <button class="btn-reset-section btn-reset-all" data-section="all">Reset todo</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-reset">Cerrar</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" style="display:none"></div>

<!-- MOBILE BOTTOM NAV -->
<nav id="mobile-nav">
  <a href="#" class="mobile-nav-item active" data-view="dashboard" id="mnav-dashboard">
    <span class="mnav-icon">ğŸ</span><span class="mnav-label">Inicio</span>
  </a>
  <a href="#" class="mobile-nav-item" data-view="championship" id="mnav-championship">
    <span class="mnav-icon">ğŸ†</span><span class="mnav-label">Campeonato</span>
  </a>
  <a href="#" class="mobile-nav-item" data-view="players" id="mnav-players">
    <span class="mnav-icon">ğŸ‘¤</span><span class="mnav-label">Pilotos</span>
  </a>
  <a href="#" class="mobile-nav-item" data-view="standings" id="mnav-standings">
    <span class="mnav-icon">ğŸ“Š</span><span class="mnav-label">Tabla</span>
  </a>
  <button class="mobile-nav-item" id="mnav-menu-btn">
    <span class="mnav-icon">â˜°</span><span class="mnav-label">MenÃº</span>
  </button>
</nav>

<!-- MOBILE MORE SHEET is now replaced by the Sidebar Drawer -->

<!-- Historic championships list -->
<div id="modal-champ-templates" class="modal-overlay" style="display:none">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h2>Campeonatos HistÃ³ricos</h2>
      <button class="modal-close" data-modal="modal-champ-templates">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="form-hint" style="margin-bottom:16px">Selecciona un campeonato histÃ³rico para cargar sus carreras y reglas oficiales.</p>
      <div class="templates-grid" id="templates-grid"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-modal="modal-champ-templates">Cerrar</button>
    </div>
  </div>
</div>

</div> <!-- #app -->

<script src="data.js"></script>
<script src="app.js"></script>
</body>
</html>
